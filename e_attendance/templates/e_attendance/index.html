{% extends "e_attendance/layout.html" %}

{% block title %}E-attendance{% endblock %}

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        let params = new URLSearchParams(location.search)
        let schoolYear = params.get("school-year");
        let semester = params.get("semester");
        document.querySelector("#school-year").value = schoolYear ? schoolYear : new Date().getFullYear();
        document.querySelector("#semester").value = semester ? semester : 2;
    })
</script>
{% endblock %}

{% block body %}
<div class="container" style="max-width: 576px;">
    <div class="card mb-5">
        <div class="card-body fw-bold text-center fs-5 px-5">
            <form action="{% url 'e_attendance:index' %}" method="get">
                <div class="d-flex mb-2">
                    <label for="school-year" class="me-auto">School Year</label>
                    <select name="school-year" id="school-year" class="form-select text-center" required>
                        <option value="">---</option>
                        <option value=2019>2019</option>
                        <option value=2020>2020</option>
                        <option value=2021>2021</option>
                        <option value=2022>2022</option>
                    </select>
                </div>
                <div class="d-flex mb-3">
                    <label for="semester" class="me-auto">Semester</label>
                    <select name="semester" id="semester" class="form-select text-center" required>
                        <option value="">---</option>
                        <option value=1>1</option>
                        <option value=2>2</option>
                    </select>
                </div>
                <input type="submit" value="Filter" class="btn btn-primary d-block w-100">
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-body px-5">
            <h1 class="text-center mb-4" id="classes">Classes</h1>
            <div class="d-grid gap-3">
                {% if user_type == "student" %}
                    {% for class in classes %}
                        <a href="{% url 'e_attendance:attendance' class.id %}" class="btn btn-primary">
                            {{ class.classs.subject.name }}
                        </a>
                    {% empty %}
                        <p>You don't have any classes in this school year and semester.</p>
                    {% endfor %}

                {% elif user_type == "instructor" %}
                    {% for class in classes %}
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown"
                                aria-expanded="false">
                                {{ class.subject.name }}
                            </button>
                            <ul class="dropdown-menu w-100 text-center">
                                <li><span class="dropdown-item"><b>Courses</b></span></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                {% for course in class.courses %}
                                <li>
                                    <div 
                                        class="dropdown-item courses"
                                        data-block-count="{{ course.block_count }}"
                                        data-bs-toggle="modal" 
                                        data-bs-target="#blocks-modal"
                                    >
                                        {{ course.student__course__name }}
                                </div>
                                </li>
                                {% endfor %}
                            </ul>
                        </div> 
                    {% empty %}
                        <p>You don't have any classes in this school year and semester.</p>
                    {% endfor %}

                {% endif %}
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="blocks-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Select a block</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container">
                        <div id="blocks" class="row gy-2">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}